---
import { getCollection } from "astro:content";
import BaseLayout from "~/layouts/BaseLayout.astro";
import { DEFAULT_LOCALE } from "~/i18n/config";
import { buildPageData } from "~/i18n/page-data";
import { localizePathname } from "~/i18n/config";

const locale = DEFAULT_LOCALE;
const pathname = "/comparisons/";
const { site } = Astro;
const pageData = buildPageData(locale, site, pathname);
const { copy } = pageData;

const title = "Comparisons: avoid re-installing after wrong picks";
const intro =
  "Scene-first conclusions with consistent dimensions: usability, stability, compatibility, performance cost, and learning curve.";

const entries = await getCollection("comparisons", (e) =>
  e.slug.startsWith(`${locale}/`),
);

const priority = (slug: string): number =>
  slug.toLowerCase().includes("skydimo") ? 0 : 1;

const items = entries
  .map((e) => {
    const slug = e.slug.split("/").slice(1).join("/");
    return {
      slug,
      title: e.data.title,
      description: e.data.description,
      href: localizePathname(locale, `/compare/${slug}/`),
      updatedAt: e.data.updatedAt,
    };
  })
  .sort((a, b) => {
    const p = priority(a.slug) - priority(b.slug);
    if (p !== 0) return p;
    const time = (b.updatedAt?.getTime() ?? 0) - (a.updatedAt?.getTime() ?? 0);
    if (time !== 0) return time;
    return a.title.localeCompare(b.title);
  });
---

<BaseLayout
  locale={locale}
  pathname={pathname}
  title={title}
  description={intro}
>
  <header class="space-y-3">
    <h1 class="text-3xl font-semibold tracking-tight">{title}</h1>
    <p class="max-w-3xl text-sm text-offset">
      {intro}
    </p>
  </header>

  <section class="mt-8 rounded-2xl border border-default bg-offset p-6">
    <h2 class="text-lg font-semibold tracking-tight">Quick comparison (conclusion first)</h2>
    <p class="mt-2 max-w-3xl text-sm text-offset">
      Start with this table, then open A-vs-B details for edge cases and migration costs.
    </p>
    <div class="mt-4 overflow-x-auto">
      <table class="min-w-[52rem] w-full text-left text-sm">
        <thead class="text-xs uppercase tracking-wide text-offset">
          <tr>
            <th class="py-2 pr-4">Software</th>
            <th class="py-2 pr-4">Screen sync</th>
            <th class="py-2 pr-4">Device control</th>
            <th class="py-2 pr-4">Latency</th>
            <th class="py-2 pr-4">Setup</th>
            <th class="py-2">Notes</th>
          </tr>
        </thead>
        <tbody class="align-top">
          <tr class="border-t border-default/60">
            <td class="py-3 pr-4 font-semibold">Skydimo</td>
            <td class="py-3 pr-4">Yes</td>
            <td class="py-3 pr-4">Strong (covers OpenRGB devices + supports part of SignalRGB devices)</td>
            <td class="py-3 pr-4">Usually low and stable</td>
            <td class="py-3 pr-4">Easy</td>
            <td class="py-3 text-offset">Download: Official website, Microsoft Store, Steam. Supports OpenRGB-compatible devices, supports part of SignalRGB devices (not fully compatible), and supports Skydimo-only products that others do not support.</td>
          </tr>
          <tr class="border-t border-default/60">
            <td class="py-3 pr-4 font-semibold">OpenRGB</td>
            <td class="py-3 pr-4">Depends (plugins / integrations)</td>
            <td class="py-3 pr-4">Strong (many devices)</td>
            <td class="py-3 pr-4">Varies by pipeline</td>
            <td class="py-3 pr-4">DIY</td>
            <td class="py-3 text-offset">Download: GitHub only. Free + local-first, but you may troubleshoot more.</td>
          </tr>
          <tr class="border-t border-default/60">
            <td class="py-3 pr-4 font-semibold">SignalRGB</td>
            <td class="py-3 pr-4">Yes</td>
            <td class="py-3 pr-4">Good (device list matters)</td>
            <td class="py-3 pr-4">Usually good</td>
            <td class="py-3 pr-4">Easy</td>
            <td class="py-3 text-offset">Download: Official website only. Polished effects; consider account/online features and CPU load.</td>
          </tr>
          <tr class="border-t border-default/60">
            <td class="py-3 pr-4 font-semibold">Hyperion</td>
            <td class="py-3 pr-4">Yes</td>
            <td class="py-3 pr-4">Via supported outputs</td>
            <td class="py-3 pr-4">Good if tuned</td>
            <td class="py-3 pr-4">Intermediate</td>
            <td class="py-3 text-offset">Great for DIY / external capture setups; configuration-heavy.</td>
          </tr>
          <tr class="border-t border-default/60">
            <td class="py-3 pr-4 font-semibold">Prismatik</td>
            <td class="py-3 pr-4">Yes</td>
            <td class="py-3 pr-4">Primarily LED controllers</td>
            <td class="py-3 pr-4">Often low</td>
            <td class="py-3 pr-4">Intermediate</td>
            <td class="py-3 text-offset">Classic PC ambilight tool; best with compatible controllers.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <div class="mt-8 grid gap-4 sm:grid-cols-2">
    {items.map((item) => (
      <a class="rounded-2xl border border-default bg-offset p-6 hover:border-secondary" href={item.href}>
        <div class="text-sm font-semibold">{item.title}</div>
        <p class="mt-2 text-sm text-offset">{item.description}</p>
        <div class="mt-4 text-xs text-offset">{copy.common.readMore} â†’</div>
      </a>
    ))}
  </div>
</BaseLayout>


---
import { Icon } from "astro-icon/components";
import type { LanguageLink, Locale } from "~/i18n/config";

export interface Props {
  label: string;
  currentLocale: Locale;
  options: LanguageLink[];
}

const { label, options, currentLocale } = Astro.props;
const activeOption =
  options.find((option) => option.code === currentLocale) ?? options[0];
---

<details
  class="language-switcher"
  data-language-switcher
  aria-label={label}
  role="listbox"
>
  <summary class="summary-button" aria-haspopup="listbox">
    <span class="label-text">{label}</span>
    <span class="current-option" lang={activeOption.code}>
      {activeOption.fullLabel}
    </span>
    <Icon name="mdi:chevron-down" class="chevron" />
  </summary>
  <ul class="options-panel">
    {options.map((option) => {
      const isActive = option.code === currentLocale;
      return (
        <li>
          <a
            class:list={[
              "block rounded px-3 py-2 text-sm transition-colors",
              isActive
                ? "bg-primary text-white"
                : "text-default hover:bg-offset",
            ]}
            lang={option.code}
            aria-current={isActive ? "true" : undefined}
            href={option.href}
            title={option.fullLabel}
            onclick={`try{localStorage.setItem('preferredLocale','${option.code}')}catch{}; this.closest('details')?.removeAttribute('open')`}
          >
            {option.fullLabel}
          </a>
        </li>
      );
    })}
  </ul>
</details>

<style>
  .language-switcher {
    @apply relative text-sm text-default;
  }
  .language-switcher summary {
    list-style: none;
  }
  .language-switcher summary::-webkit-details-marker {
    display: none;
  }
  .summary-button {
    @apply flex cursor-pointer items-center gap-2 rounded border border-default px-3 py-1 transition-colors;
    @apply hover:border-secondary;
    background-color: color-mix(in srgb, var(--color-background) 70%, transparent);
    backdrop-filter: blur(10px);
  }
  .label-text {
    @apply text-xs uppercase tracking-wide text-offset;
  }
  .chevron {
    @apply size-3 text-offset;
  }
  .current-option {
    @apply font-semibold text-default;
  }
  .options-panel {
    @apply absolute right-0 mt-2 w-44 space-y-1 rounded border border-default bg-default p-2;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
    z-index: 40;
  }
  .language-switcher:not([open]) .options-panel {
    display: none;
  }
</style>


---
import { Icon } from "astro-icon/components";
import type { LanguageLink, Locale } from "~/i18n/config";

export interface Props {
  label: string;
  currentLocale: Locale;
  options: LanguageLink[];
}

const { label, options, currentLocale } = Astro.props;
const activeOption =
  options.find((option) => option.code === currentLocale) ?? options[0];
---

<details
  class="language-switcher"
  data-language-switcher
  aria-label={label}
  role="listbox"
>
  <summary class="summary-button" aria-haspopup="listbox">
    <span class="text-xs uppercase tracking-wide text-white/70">{label}</span>
    <span class="current-option" lang={activeOption.code}>
      {activeOption.fullLabel}
    </span>
    <Icon name="mdi:chevron-down" class="size-3 text-white/70" />
  </summary>
  <ul class="options-panel">
    {options.map((option) => {
      const isActive = option.code === currentLocale;
      return (
        <li>
          <a
            class:list={[
              "block rounded px-3 py-2 text-sm transition-colors",
              isActive
                ? "bg-primary text-black"
                : "text-white/80 hover:bg-white/10 hover:text-white",
            ]}
            lang={option.code}
            aria-current={isActive ? "true" : undefined}
            href={option.href}
            title={option.fullLabel}
            onClick={`try{localStorage.setItem('preferredLocale','${option.code}')}catch{}; this.closest('details')?.removeAttribute('open')`}
          >
            {option.fullLabel}
          </a>
        </li>
      );
    })}
  </ul>
</details>

<style>
  .language-switcher {
    @apply relative text-sm text-white;
  }
  .language-switcher summary {
    list-style: none;
  }
  .language-switcher summary::-webkit-details-marker {
    display: none;
  }
  .summary-button {
    @apply flex cursor-pointer items-center gap-2 rounded border border-white/20 px-3 py-1 text-xs uppercase tracking-wide text-white/80 transition-colors hover:border-white/60;
  }
  .current-option {
    @apply font-semibold text-white;
  }
  .options-panel {
    @apply absolute right-0 mt-2 w-40 space-y-1 rounded border border-white/10 bg-black/90 p-2 backdrop-blur;
    z-index: 40;
  }
  .language-switcher:not([open]) .options-panel {
    display: none;
  }
</style>

